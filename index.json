{"repository_name":"github.com/wopian/hibari-api","body":"# Hibari API\n\nWork in progress API backend for extra Kitsu statistics for [Hibari](https://github.com/wopian/hibari)\n\nInitially developed as part of the *Web Services* module at Bucks New University\n\n## Installation\n\nTODO: Write installation instructions here\n\n## Usage\n\nTODO: Write usage instructions here\n\nSSL:\n```bash\ncrystal build --release src/api.cr\n./api --ssl --ssl-key-file your_key_file --ssl-cert-file your_cert_file\n```\n## Development\n\n### External Dependencies\n\n- sqlite3 (libsqlite3-dev)\n\n### Commands\n\n#### Install Shards\n\n```shell\ncrystal deps\n```\n\n#### Start Dev Server\n\n```shell\ncrystal src/api.cr\n```\n\n#### Run Tests\n\n```shell\ncrystal spec\n```\n\n#### Update Documentation\n\n```shell\ncrystal docs\n```\n\n#### Build Server\n\n```shell\ncrystal build src/api.cr --release\n./api\n```\n\n## Contributing\n\n1. [Fork it](https://github.com/wopian/hibari-api/fork)\n2. Create your feature branch (`git checkout -b feat/myFeature`)\n3. Commit your changes (`git commit -am 'feat: add my feature'`)\n4. Push to the branch (`git push origin feat/myFeature`)\n5. Create a Pull Request\n\n## Contributors\n\n- [wopian](https://github.com/wopian) James Harris - creator, maintainer\n","program":{"html_id":"github.com/wopian/hibari-api/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"github.com/wopian/hibari-api","program":true,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"github.com/wopian/hibari-api/Hibari","path":"Hibari.html","kind":"module","full_name":"Hibari","name":"Hibari","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"hibari/extend.cr","line_number":1,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/hibari/extend.cr"},{"filename":"hibari/headers.cr","line_number":1,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/hibari/headers.cr"},{"filename":"hibari/table_names.cr","line_number":1,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/hibari/table_names.cr"},{"filename":"hibari/version.cr","line_number":1,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/hibari/version.cr"},{"filename":"api.cr","line_number":27,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/api.cr"}],"repository_name":"github.com/wopian/hibari-api","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[{"name":"HEADERS","value":"{\"Content-Type\" => JsonAPI::CONTENT_TYPE, \"Strict-Transport-Security\" => \"max-age=63072000; includeSubDomains; preload\", \"Content-Security-Policy\" => \"default-src 'none'\", \"Cache-Control\" => \"max-age=900\", \"Server\" => \"api.hibari.moe\", \"X-Powered-By\" => \"api.hibari.moe\", \"X-Frame-Options\" => \"SAMEORIGIN\", \"X-XSS-Protection\" => \"1; mode=block\", \"X-Content-Type-Options\" => \"nosniff\", \"Referrer-Policy\" => \"origin-when-cross-origin, strict-origin-when-cross-origin\"}","doc":"Response headers for the Hibari API","summary":"<p>Response headers for the Hibari API</p>"},{"name":"VERSION","value":"\"0.1.0\"","doc":null,"summary":null}],"included_modules":[],"extended_modules":[{"html_id":"github.com/wopian/hibari-api/Hibari","kind":"module","full_name":"Hibari","name":"Hibari"},{"html_id":"github.com/wopian/hibari-api/Hibari/Errors","kind":"module","full_name":"Hibari::Errors","name":"Errors"}],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"table_names(db)-instance-method","html_id":"table_names(db)-instance-method","name":"table_names","doc":"Creates a hash map of all the tables in the database","summary":"<p>Creates a hash map of all the tables in the database</p>","abstract":false,"args":[{"name":"db","doc":null,"default_value":"","external_name":"db","restriction":""}],"args_string":"(db)","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/hibari/table_names.cr#L3","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/hibari/table_names.cr#L3","def":{"name":"table_names","args":[{"name":"db","doc":null,"default_value":"","external_name":"db","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"sql = \"SELECT name FROM sqlite_master WHERE type='table';\"\ndb.query_all(sql, as: String)\n"}}],"macros":[],"types":[{"html_id":"github.com/wopian/hibari-api/Hibari/Errors","path":"Hibari/Errors.html","kind":"module","full_name":"Hibari::Errors","name":"Errors","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"errors.cr","line_number":4,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/errors.cr"}],"repository_name":"github.com/wopian/hibari-api","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[{"html_id":"github.com/wopian/hibari-api/Hibari/Errors","kind":"module","full_name":"Hibari::Errors","name":"Errors"}],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/wopian/hibari-api/Hibari","kind":"module","full_name":"Hibari","name":"Hibari"},"doc":"Error endpoints for the Hibari API.\n\nEach error returns a JSON:API formatted error response","summary":"<p>Error endpoints for the Hibari API.</p>","class_methods":[],"constructors":[],"instance_methods":[{"id":"set_error_headers(env)-instance-method","html_id":"set_error_headers(env)-instance-method","name":"set_error_headers","doc":"Sets the response headers for each error endpoint\n\nTODO: Find why before_all doesn't apply to error endpoints","summary":"<p>Sets the response headers for each error endpoint</p>","abstract":false,"args":[{"name":"env","doc":null,"default_value":"","external_name":"env","restriction":""}],"args_string":"(env)","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/errors.cr#L10","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/errors.cr#L10","def":{"name":"set_error_headers","args":[{"name":"env","doc":null,"default_value":"","external_name":"env","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"headers(env, Hibari::HEADERS)"}}],"macros":[],"types":[]},{"html_id":"github.com/wopian/hibari-api/Hibari/JsonAPI","path":"Hibari/JsonAPI.html","kind":"module","full_name":"Hibari::JsonAPI","name":"JsonAPI","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"json_api/construct_data.cr","line_number":1,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/construct_data.cr"},{"filename":"json_api/construct_field.cr","line_number":1,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/construct_field.cr"},{"filename":"json_api/construct_resource.cr","line_number":1,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/construct_resource.cr"},{"filename":"json_api/content_type.cr","line_number":1,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/content_type.cr"},{"filename":"json_api/error.cr","line_number":1,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/error.cr"},{"filename":"json_api/extend.cr","line_number":1,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/extend.cr"},{"filename":"json_api/response.cr","line_number":1,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/response.cr"}],"repository_name":"github.com/wopian/hibari-api","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[{"name":"CONTENT_TYPE","value":"\"application/vnd.api+json\"","doc":null,"summary":null}],"included_modules":[],"extended_modules":[{"html_id":"github.com/wopian/hibari-api/Hibari/JsonAPI","kind":"module","full_name":"Hibari::JsonAPI","name":"JsonAPI"}],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/wopian/hibari-api/Hibari","kind":"module","full_name":"Hibari","name":"Hibari"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"construct_data(json,col_names,rs)-instance-method","html_id":"construct_data(json,col_names,rs)-instance-method","name":"construct_data","doc":"Creates the data array of the JSON:API response\n\nReturns the following JSON structure:\n\n```json\n{\n  \"data\": [\n    { ... }\n  ]\n}\n```","summary":"<p>Creates the data array of the JSON:API response</p>","abstract":false,"args":[{"name":"json","doc":null,"default_value":"","external_name":"json","restriction":""},{"name":"col_names","doc":null,"default_value":"","external_name":"col_names","restriction":""},{"name":"rs","doc":null,"default_value":"","external_name":"rs","restriction":""}],"args_string":"(json, col_names, rs)","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/construct_data.cr#L13","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/construct_data.cr#L13","def":{"name":"construct_data","args":[{"name":"json","doc":null,"default_value":"","external_name":"json","restriction":""},{"name":"col_names","doc":null,"default_value":"","external_name":"col_names","restriction":""},{"name":"rs","doc":null,"default_value":"","external_name":"rs","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"json.field(\"data\") do\n  json.array do\n    rs.each do\n      construct_resource(json, col_names, rs)\n    end\n  end\nend"}},{"id":"construct_field(json,col,value)-instance-method","html_id":"construct_field(json,col,value)-instance-method","name":"construct_field","doc":"Creates the fields of JSON:API responses\n\nReturns the following JSON structures:\n\n```json\n\"key\": \"value\"\n```\n\n```json\n\"key\": [ \"value\" ]\n```","summary":"<p>Creates the fields of JSON:API responses</p>","abstract":false,"args":[{"name":"json","doc":null,"default_value":"","external_name":"json","restriction":""},{"name":"col","doc":null,"default_value":"","external_name":"col","restriction":""},{"name":"value","doc":null,"default_value":"","external_name":"value","restriction":""}],"args_string":"(json, col, value)","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/construct_field.cr#L15","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/construct_field.cr#L15","def":{"name":"construct_field","args":[{"name":"json","doc":null,"default_value":"","external_name":"json","restriction":""},{"name":"col","doc":null,"default_value":"","external_name":"col","restriction":""},{"name":"value","doc":null,"default_value":"","external_name":"value","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"case value\nwhen Bytes\n  json.field(col) do\n    json.array do\n      value.each do |e|\n        json.scalar(e)\n      end\n    end\n  end\nwhen NotSupported\nelse\n  json.field(col) do\n    value.to_json(json)\n  end\nend"}},{"id":"construct_resource(json,col_names,rs)-instance-method","html_id":"construct_resource(json,col_names,rs)-instance-method","name":"construct_resource","doc":"Creates the JSON:API resource object\n\nReturns the following JSON structure:\n\n```json\n{\n  \"col_name\": \"value\",\n  ...\n}\n```","summary":"<p>Creates the JSON:API resource object</p>","abstract":false,"args":[{"name":"json","doc":null,"default_value":"","external_name":"json","restriction":""},{"name":"col_names","doc":null,"default_value":"","external_name":"col_names","restriction":""},{"name":"rs","doc":null,"default_value":"","external_name":"rs","restriction":""}],"args_string":"(json, col_names, rs)","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/construct_resource.cr#L12","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/construct_resource.cr#L12","def":{"name":"construct_resource","args":[{"name":"json","doc":null,"default_value":"","external_name":"json","restriction":""},{"name":"col_names","doc":null,"default_value":"","external_name":"col_names","restriction":""},{"name":"rs","doc":null,"default_value":"","external_name":"rs","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"json.object do\n  col_names.each do |col|\n    construct_field(json, col, rs.read)\n  end\nend"}},{"id":"error(status,title,detail=title)-instance-method","html_id":"error(status,title,detail=title)-instance-method","name":"error","doc":null,"summary":null,"abstract":false,"args":[{"name":"status","doc":null,"default_value":"","external_name":"status","restriction":""},{"name":"title","doc":null,"default_value":"","external_name":"title","restriction":""},{"name":"detail","doc":null,"default_value":"title","external_name":"detail","restriction":""}],"args_string":"(status, title, detail = title)","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/error.cr#L2","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/error.cr#L2","def":{"name":"error","args":[{"name":"status","doc":null,"default_value":"","external_name":"status","restriction":""},{"name":"title","doc":null,"default_value":"","external_name":"title","restriction":""},{"name":"detail","doc":null,"default_value":"title","external_name":"detail","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"({errors: [{title: title, detail: detail, status: status, code: status}]}).to_json"}},{"id":"response(col_names,rs)-instance-method","html_id":"response(col_names,rs)-instance-method","name":"response","doc":"Creates the JSON:API response object","summary":"<p>Creates the JSON:API response object</p>","abstract":false,"args":[{"name":"col_names","doc":null,"default_value":"","external_name":"col_names","restriction":""},{"name":"rs","doc":null,"default_value":"","external_name":"rs","restriction":""}],"args_string":"(col_names, rs)","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/response.cr#L3","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/response.cr#L3","def":{"name":"response","args":[{"name":"col_names","doc":null,"default_value":"","external_name":"col_names","restriction":""},{"name":"rs","doc":null,"default_value":"","external_name":"rs","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"JSON.build do |json|\n  json.object do\n    construct_data(json, col_names, rs)\n  end\nend"}}],"macros":[],"types":[{"html_id":"github.com/wopian/hibari-api/Hibari/JsonAPI/NotSupported","path":"Hibari/JsonAPI/NotSupported.html","kind":"alias","full_name":"Hibari::JsonAPI::NotSupported","name":"NotSupported","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"json_api/construct_field.cr","line_number":2,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/json_api/construct_field.cr"}],"repository_name":"github.com/wopian/hibari-api","program":false,"enum":false,"alias":true,"aliased":"(Char | JSON::Any)","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/wopian/hibari-api/Hibari/JsonAPI","kind":"module","full_name":"Hibari::JsonAPI","name":"JsonAPI"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[]}]},{"html_id":"github.com/wopian/hibari-api/Hibari/Kitsu","path":"Hibari/Kitsu.html","kind":"module","full_name":"Hibari::Kitsu","name":"Kitsu","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"kitsu/base_url.cr","line_number":1,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/kitsu/base_url.cr"},{"filename":"kitsu/extend.cr","line_number":1,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/kitsu/extend.cr"},{"filename":"kitsu/get.cr","line_number":4,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/kitsu/get.cr"},{"filename":"kitsu/version.cr","line_number":1,"url":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/kitsu/version.cr"}],"repository_name":"github.com/wopian/hibari-api","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[{"name":"BASE_URL","value":"\"https://kitsu.io/api/#{VERSION}/\"","doc":"URL of Kitsu.io's API","summary":"<p>URL of Kitsu.io's API</p>"},{"name":"VERSION","value":"\"edge\"","doc":null,"summary":null}],"included_modules":[],"extended_modules":[{"html_id":"github.com/wopian/hibari-api/Hibari/Kitsu","kind":"module","full_name":"Hibari::Kitsu","name":"Kitsu"}],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/wopian/hibari-api/Hibari","kind":"module","full_name":"Hibari","name":"Hibari"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"get(resource,params=nil)-instance-method","html_id":"get(resource,params=nil)-instance-method","name":"get","doc":null,"summary":null,"abstract":false,"args":[{"name":"resource","doc":null,"default_value":"","external_name":"resource","restriction":""},{"name":"params","doc":null,"default_value":"nil","external_name":"params","restriction":""}],"args_string":"(resource, params = <span class=\"n\">nil</span>)","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/kitsu/get.cr#L5","source_link":"https://github.com/wopian/hibari-api/blob/03c7e87ca31b775c6c5bf99e5e63b61c2babfff8/src/kitsu/get.cr#L5","def":{"name":"get","args":[{"name":"resource","doc":null,"default_value":"","external_name":"resource","restriction":""},{"name":"params","doc":null,"default_value":"nil","external_name":"params","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"uri = URI.parse(BASE_URL + resource)\nuri.query = params.to_s\nresponse = HTTP::Client.get(uri, headers: HTTP::Headers {\"Content-Type\" => Hibari::JsonAPI::CONTENT_TYPE, \"Accepts\" => Hibari::JsonAPI::CONTENT_TYPE, \"User-Agent\" => \"hibari-api/#{Hibari::VERSION}/#{Crystal::VERSION} (wopian/hibari-api)\"})\nJSON.parse(response.body)\n"}}],"macros":[],"types":[]}]}]}}